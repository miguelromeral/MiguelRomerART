@using MRA.Services
@using MRA.Services.Firebase.Models
@using MRA.Web.Models.Admin
@model EditDrawingViewModel
@{
    ViewBag.Title = (Model.IsEditing ? $"Editando \"{Model.Drawing?.Id}\"" : "Crear Nuevo Dibujo");
}


@section Styles {
    <link href="~/css/site.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/css/images.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/css/image-details.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/css/admin.css" rel="stylesheet" asp-append-version="true" />
}

<div class="container">
    <div class="row d-flex flex-row-reverse">
        <div class="col-12 col-sm-12 col-md-12 col-lg-4">
            <div class="container mr-lista-imagenes">
                <div class="row">
                    <div class="col-12 col-sm-12 col-md-12">
                        <label>Imagen A Tamaño Completo</label>
                        <img src="@Model.Drawing?.Url" id="imgPreviewFullSize" />
                    </div>
                    <div class="col-12 col-sm-12 col-md-12">
                        <label>Miniatura</label>
                        <img src="@Model.Drawing?.UrlThumbnail" id="imgPreviewThumbnail" />
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-sm-12 col-md-12 col-lg-8">

            <div class="container">
                <form id="formDrawing" asp-action="SaveDrawing"
                      data-ajax="true" data-ajax-method="POST"
                      data-ajax-failure="onFailureSaveDrawing"
                      data-ajax-success="onSuccessSaveDrawing">
                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12">
                            <div class="mr-admin-form-control">
                                <input type="hidden" asp-for="Drawing.Likes" />
                                <input type="hidden" asp-for="Drawing.Views" />
                                <input type="hidden" asp-for="Drawing.ScorePopular" />
                                <input type="hidden" asp-for="Drawing.VotesPopular" />
                                <label>ID</label>
                                @if (!Model.IsEditing)
                                {
                                    <input asp-for="Drawing.Id" id="iDrawingId" class="form-control mr-custom-text" type="text"
                                           placeholder="ID" onchange="checkDrawingId(this)" />
                                }
                                <div class="mr-not-editable-value" id="divDrawingId"
                                    style="display: @(Model.IsEditing ? "block" : "none")">@Model.Drawing.Id</div>
                                <input type="hidden" name="Drawing.Id" id="iHiddenDrawingId" value="@Model.Drawing.Id" />

                                <a href="@Url.Action("Details", "Art", new { id = Model.Drawing?.Id })" >Ver Dibujo</a>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-6">
                            <div class="mr-admin-form-control">
                                <label>Ruta en Azure</label>
                                <input asp-for="Drawing.Path" id="azurePath" class="form-control mr-custom-text" type="text" placeholder="Ruta en Azure Container" value="@Model.Drawing.Path" onchange="onChangeAzurePath(this)" />
                                <input id="iHiddenUrlThumbnail" type="hidden" asp-for="Drawing.PathThumbnail" value="@Model.Drawing.PathThumbnail" />
                            </div>
                        </div>
                    </div>
                    <div class="row" id="rowUploadToAzure" style="display: none;">
                        <div class="col-12 col-sm-12 col-md-6">
                            <img id="imgTmp" src="#" alt="Image que se va a subir">
                        </div>
                        <div class="col-12 col-sm-12 col-md-6">
                            <div class="mr-admin-form-control">
                                <label>Selecciona el Fichero</label>
                                <input name="azureImage" class="form-control" type="file" id="azureImage" accept="image/png, image/gif, image/jpeg" onchange="mostrarImagenAzureTmp()">
                            </div>
                            <div class="mr-admin-form-control">
                                <label>Tamaño de la miniatura</label>
                                <input name="azureImageThumbnailSize" class="form-control mr-custom-text" value="350" type="number" min="100" max="1000" id="azureImageThumbnailSize">
                            </div>
                            <button id="btnUploadToAzure" type="button" class="btn btn-primary mr-custom-btn" onclick="event.stopPropagation(); uploadAzureImage();">
                                <i class="bi bi-cloud-upload"></i><span class="mr-texto-button"> Subir a Azure</span>
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-10">
                            <div class="mr-admin-form-control">
                                <label>Título del Dibujo</label>
                                <input asp-for="Drawing.Title" class="form-control mr-custom-text" type="text" placeholder="Título del Dibujo" value="@Model.Drawing.Title" />
                            </div>
                        </div>
                        <div class="col-12 col-sm-12 col-md-2">
                            <div class="mr-admin-form-control">
                                <label>Favorito</label>
                                <input type="hidden" asp-for="Drawing.Favorite"
                                       value="@(Model.Drawing.Favorite ? "true" : "false")"
                                       id="FavoriteHidden" />

                                <input type="checkbox" name="Drawing.Favorite"
                                       class="form-control form-check-input mr-custom-checkbox"
                                       onchange="updateCheckValue(this, 'FavoriteHidden');"
                                @(Model.Drawing.Favorite ? "checked" : "") />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-6">
                            <div class="mr-admin-form-control">
                                <label>Nombre del Personaje</label>
                                <input asp-for="Drawing.Name" class="form-control mr-custom-text" type="text" placeholder="Nombre del personaje" value="@Model.Drawing.Name" />
                            </div>
                        </div>
                        <div class="col-12 col-sm-12 col-md-6">
                            <div class="mr-admin-form-control">
                                <label>Nombre del Modelo</label>
                                <input asp-for="Drawing.ModelName" class="form-control mr-custom-text" type="text" placeholder="Nombre del modelo" value="@Model.Drawing.ModelName" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-4">
                            <div class="mr-admin-form-control">
                                <label>Tipo de Dibujo</label>
                                <select asp-for="Drawing.Type" class="mr-custom-select form-select form-select-sm" data-bs-theme="dark">
                                    <option value="0"></option>
                                    @foreach (var type in MRA.Services.Firebase.Models.Drawing.DRAWING_TYPES.Where(x => x.Key > 0).OrderBy(x => x.Value))
                                    {
                                        <option value="@(type.Key)">@(type.Value)</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-12 col-sm-12 col-md-4">
                            <div class="mr-admin-form-control">
                                <label>Software</label>
                                <select asp-for="Drawing.Software" class="mr-custom-select form-select form-select-sm" data-bs-theme="dark">
                                    <option value="0"></option>
                                    @foreach (var type in MRA.Services.Firebase.Models.Drawing.DRAWING_SOFTWARE.Where(x => x.Key > 0).OrderBy(x => x.Value))
                                    {
                                        <option value="@(type.Key)">@(type.Value)</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-12 col-sm-12 col-md-4">
                            <div class="mr-admin-form-control">
                                <label>Tamaño de Papel</label>
                                <select asp-for="Drawing.Paper" class="mr-custom-select form-select form-select-sm" data-bs-theme="dark">
                                    <option value="0"></option>
                                    @foreach (var type in MRA.Services.Firebase.Models.Drawing.DRAWING_PAPER_SIZE.Where(x => x.Key > 0 && x.Key > 3).OrderBy(x => x.Value))
                                    {
                                        <option value="@(type.Key)">@(type.Value)</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-4">
                            <div class="mr-admin-form-control">
                                <label>Fecha de Creación</label>
                                <input type="hidden" id="iHiddenDate" name="Drawing.Date" value="@Model.Drawing.Date" />
                                <input type="date" class="mr-custom-text" onchange="onChangeInputDate(this, 'iHiddenDate');" value="@Utilities.FormattedDateInput(Model.Drawing.Date)">
                            </div>
                        </div>
                        <div class="col-12 col-sm-12 col-md-4">
                            <div class="mr-admin-form-control">
                                <label>Puntuación</label>
                                <input type="number" asp-for="Drawing.ScoreCritic" step="1" min="0" max="100"
                                       class="form-control mr-custom-text zero-if-null" placeholder="0" />
                            </div>
                        </div>
                        <div class="col-12 col-sm-12 col-md-4">
                            <div class="mr-admin-form-control">
                                <label>Tiempo en Minutos</label>
                                <input type="number" asp-for="Drawing.Time" step="1" min="0"
                                       class="form-control mr-custom-text zero-if-null" placeholder="0" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-6">
                            <div class="mr-admin-form-control">
                                <label>Tipo de Producto</label>
                                <select asp-for="Drawing.ProductType" class="mr-custom-select form-select form-select-sm" data-bs-theme="dark">
                                    <option value="0"></option>
                                    @foreach (var type in MRA.Services.Firebase.Models.Drawing.DRAWING_PRODUCT_TYPES.Where(x => x.Key > 0).OrderBy(x => x.Value))
                                    {
                                        <option value="@(type.Key)">@(type.Value)</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-12 col-sm-12 col-md-6">
                            <div class="mr-admin-form-control">
                                <label>Nombre del Producto</label>
                                <input asp-for="Drawing.ProductName" class="form-control mr-custom-text" type="text" placeholder="Nombre del Producto" value="@Model.Drawing.ProductName" />
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12">
                            <div class="mr-admin-form-control">
                                <label>Comentarios</label>

                                <div id="divListComments">
                                    <input type="hidden" id="iHiddenComment" asp-for="Drawing.Comment" />
                                    @for (int i = 0; i < Model.Drawing.ListComments.Count; i++)
                                    {
                                        <script type="text/javascript">
                                            document.addEventListener("DOMContentLoaded", function (event) {
                                                addNewComment('divListComments', 'iHiddenComment', 'mr-comment', `@(Html.Raw(Model.Drawing.ListComments[i]))`);
                                            });
                                        </script>
                                    }
                                </div>

                                <button type="button" class="btn btn-primary mr-custom-btn"
                                        onclick="addNewComment('divListComments', 'iHiddenComment', 'mr-comment');">
                                    <i class="bi bi-plus"></i><span class="mr-texto-button"> Nuevo Comentario</span>
                                </button>
                            </div>
                        </div>
                    </div>


                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-6">
                            <div class="mr-admin-form-control">
                                <label>Comentrios Positivos</label>

                                <div id="divListCommentsPros">
                                    <input type="hidden" id="iHiddenCommentPros" asp-for="Drawing.CommentPros" />
                                    @for (int i = 0; i < Model.Drawing.ListCommentPros.Count; i++)
                                    {
                                        <script type="text/javascript">
                                            document.addEventListener("DOMContentLoaded", function (event) {
                                                addNewComment('divListCommentsPros', 'iHiddenCommentPros', 'mr-comment-pro', `@(Html.Raw(Model.Drawing.ListCommentPros[i]))`);
                                            });
                                        </script>
                                    }
                                </div>

                                <button type="button" class="btn btn-primary mr-custom-btn"
                                        onclick="addNewComment('divListCommentsPros', 'iHiddenCommentPros', 'mr-comment-pro');">
                                    <i class="bi bi-plus"></i><span class="mr-texto-button"> Nuevo Comentario</span>
                                </button>
                            </div>
                        </div>
                        <div class="col-12 col-sm-12 col-md-12 col-lg-6">
                            <div class="mr-admin-form-control">
                                <label>Comentarios Negativos</label>

                                <div id="divListCommentsCons">
                                    <input type="hidden" id="iHiddenCommentCons" asp-for="Drawing.CommentCons" />
                                    @for (int i = 0; i < Model.Drawing.ListCommentCons.Count; i++)
                                    {
                                        <script type="text/javascript">
                                            document.addEventListener("DOMContentLoaded", function (event) {
                                                addNewComment('divListCommentsCons', 'iHiddenCommentCons', 'mr-comment-con', `@(Html.Raw(Model.Drawing.ListCommentCons[i]))`);
                                            });
                                        </script>
                                    }
                                </div>

                                <button type="button" class="btn btn-primary mr-custom-btn"
                                        onclick="addNewComment('divListCommentsCons', 'iHiddenCommentCons', 'mr-comment-con');">
                                    <i class="bi bi-plus"></i><span class="mr-texto-button"> Nuevo Comentario</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12">
                            <div class="mr-admin-form-control">
                                <label>Etiquetas (separadas por espacios)</label>
                                <input asp-for="Drawing.TagsText" class="form-control mr-custom-text" type="text" placeholder="Etiquetas"
                                       value="@String.Join(" ", Model.Drawing.Tags)" />
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-6">
                            <div class="mr-admin-form-control">
                                <label>URL Imagen de Referencia</label>
                                <input id="iImgReferencia" asp-for="Drawing.ReferenceUrl" class="form-control mr-custom-text" type="text" placeholder="URL de la Imagen de Referencia" value="@Model.Drawing.ReferenceUrl" onchange="actualizarImagenReferencia(this);" />

                                <img id="imgReferencia" src="@(Model.Drawing.ReferenceUrl)" />
                            </div>

                        </div>
                        <div class="col-12 col-sm-12 col-md-6">
                            <div class="mr-admin-form-control">
                                <label>URL de Spotify</label>
                                <input asp-for="Drawing.SpotifyUrl" class="form-control mr-custom-text" type="text" placeholder="URL de Spotify" value="@Model.Drawing.SpotifyUrl" />
                            </div>
                        </div>
                    </div>

                </form>
                <div class="row mt-2">
                    <div class="col-12 col-sm-12 col-md-12">
                        <button class="btn btn-primary mr-custom-btn" id="btnSaveDrawing" onclick="sendForm();"
                            @(!Model.IsEditing ? "disabled" : "")>
                            <i class="bi bi-floppy"></i> <span class="mr-texto-button"> Guardar Cambios</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/admin.js" asp-append-version="true"></script>
}